# AI骰娘4 - 海豹骰子智能交互插件

![license](https://img.shields.io/badge/license-MIT-green)
![version](https://img.shields.io/badge/version-4.4.0-blue)

## 部分开放平台地址
* [DeepSeek](https://platform.deepseek.com/)
* [Moonshot AI](https://platform.moonshot.cn/)
* [阿里云百炼](https://www.aliyun.com/product/bailian)
* [智谱AI](https://bigmodel.cn/)
* [讯飞星火](https://www.xfyun.cn/)
* [豆包大模型](https://www.volcengine.com/product/doubao)

## 目录

- [项目概述](#项目概述)
- [功能特性](#功能特性)
- [安装与使用](#安装与使用)
  - [环境要求](#环境要求)
  - [安装步骤](#安装步骤)
  - [基础使用](#基础使用)
- [配置说明](#配置说明)
  - [核心配置项](#核心配置项)
  - [功能开关](#功能开关)
  - [图片配置](#图片配置)
- [项目结构](#项目结构)
- [核心模块](#核心模块)
- [扩展](#扩展)
- [注意事项](#注意事项)
- [版权信息](#版权信息)
- [致谢](#致谢)

## 项目概述

AI骰娘4是一款面向TRPG玩家（吗？）的智能对话插件，基于OpenAI兼容API开发。本插件深度整合了海豹骰子核心功能，提供以下核心能力：

- **智能对话**：支持上下文感知的AI对话
- **多功能集成**：内置20+实用功能（属性检定、牌堆抽取、记忆管理等），并且持续更新
- **图像处理**：支持图片识别、表情包管理和盗图功能
- **权限系统**：多维度权限控制体系

## 功能特性

### 核心功能
- 上下文感知的智能对话
- 基于正则表达式的关键词触发
- 多模式响应机制（计数器/计时器/概率触发）
- 支持函数调用

### 扩展功能
- 🎲 属性检定系统（COC7规则）
- 🃏 智能牌堆抽取
- 🧠 长期记忆管理
- 📷 图片识别与处理
- ⏰ 定时提醒系统
- 🔧 权限管理系统
- ...

## 安装与使用

### 环境要求
- 海豹骰子核心v1.4.6+
- 支持的AI平台：
  - Deepseek
  - 智谱AI
  - 其他兼容OpenAI API的平台

### 安装步骤
1. 在海豹核心webui-扩展功能-JS扩展-插件列表-上传JS处上传该js文件
2. 执行重载JS插件命令
3. 在插件设置配置API密钥等等

### 基础使用
```海豹指令
# 查看帮助文档
.ai help
```

## 配置说明

### 图片配置
```javascript
// 本地图片路径配置示例
<sealdice>data/images/dice.png
<表情包1>http://example.com/emoji1.jpg
```

## 项目结构

```
aiplugin4/
├── src/
│   ├── config/        # 配置相关
│   │   ├── config.ts  # 配置管理
│   │   └── ...
│   ├── tools/         # 调用函数扩展
│   │   ├── tool.ts     # 工具管理
│   │   └──...
│   ├── AI/            # 核心逻辑
│   │   ├── AI.ts       # 核心AI逻辑
│   │   ├── context.ts  # 上下文管理
│   │   ├── memory.ts   # 记忆管理
│   │   ├── image.ts    # 图片处理
│   │   └── service.ts  # 服务管理，包括API调用
│   └── utils/         # 工具函数
└── package.json       # 项目依赖
```

## 核心模块

### 1. 对话管理系统
- 上下文管理（Context）
- 记忆持久化（Memory）
- 多轮对话处理

### 2. 功能调用系统
- ...

### 3. 图像处理引擎
- 图片盗取系统
- 本地图片管理
- 视觉模型集成

## 扩展

### 添加新功能
1. 在`src/tools/`目录创建新工具
2. 实现工具接口
3. 注册到工具管理系统

### 添加新配置
1. 在`src/config/`目录创建新配置项（或者添加到现有配置项，该方法无需后续注册）
2. 实现`register`方法和`get`方法
3. 注册到配置管理系统

## 注意事项

### 常见问题
1. **API调用失败**：检查网络连接和API密钥
2. **图片识别异常**：确认图片URL有效性
3. **权限问题**：使用`.ai pr`检查当前权限设置

## 版权信息

本项目采用MIT开源协议，欢迎二次开发。原创作者保留署名权。

```text
Copyright 2024 错误、白鱼

Permission is hereby granted...
```

## 致谢

- 海豹骰子开发团队
- 开源社区贡献者

---

> 项目维护：错误、白鱼  
> 问题反馈：https://github.com/baiyu-yu/plug-in/issues
> 更新日期：2024-12-05